{% extends "base.html" %}
{% block title %}Add Medicine{% endblock %}

{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/autosave.css') }}">
<link rel="stylesheet" href="/static/css/add_medicine.css">
<link rel="stylesheet" href="/static/css/components.css">

<style>
/* Time of Day Grid - FIXED */
.tod-pics {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.tod-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 1rem;
  border: 2px solid #ddd;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
}

.tod-item input[type="checkbox"] {
  display: none;
}

.tod-item input[type="checkbox"]:checked + img {
  border-color: #4c8bfd;
}

.tod-item:has(input:checked) {
  border-color: #4c8bfd;
  background-color: #f0f7ff;
}

.tod-item img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 50%;
  border: 3px solid transparent;
  margin-bottom: 0.5rem;
}

.tod-label {
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #333;
}

/* Reminder Options */
.reminder-options {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin: 1rem 0;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 8px;
}

.reminder-checkbox-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.reminder-checkbox-group input[type="checkbox"] {
  width: auto;
  margin: 0;
}

.reminder-checkbox-group label {
  margin: 0;
  font-weight: normal;
  cursor: pointer;
}
</style>

<div class="add-med-container">

  <!-- Header -->
  <div class="page-head" style="display:flex;flex-direction:column;gap:8px;">
    <h1 class="page-title page-title--cobalt">YOUR MEDICINES REMINDER</h1>

    <div class="autosave-card">
      <div class="autosave-left">
        <h3 class="autosave-title">Auto-Save</h3>
      </div>
    
      <div class="autosave-right">
          <label class="switch" aria-label="Auto-Save toggle">
            <input type="checkbox" id="autoSaveToggle" aria-label="Enable or disable automatic saving">
            <span class="slider round"></span>
          </label>
          <p id="autoSaveStatus" class="autosave-status autosave-on" aria-live="polite" role="status" aria-atomic="true">
            Saving automatically
          </p>
      </div>
    </div>
  </div>

  <form id="medicineForm" autocomplete="off" novalidate method="POST" action="{{ url_for('add_medicine_page') }}">

    <div id="medicineCards">

      <div class="medicine-card" data-index="0">
        <div class="medicine-card__header">
          <div class="medicine-card__title">
            <span class="pill-emoji">üíä</span>
            <h3>Medicine 1</h3>
          </div>

          <div class="medicine-card__actions">
            <button type="button" class="action-box action-box--remove" title="Remove medicine" aria-label="Remove medicine">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#E53935" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6zm2 3h2v9H5V9zm4 0h2v9H9V9zm4 0h2v9h-2V9zm4 0h2v9h-2V9zM9 2h6v2H9V2z" /></svg>
              <span class="action-text">Remove</span>
            </button>

            <button type="button" class="action-box action-box--toggle" aria-expanded="true" title="Toggle collapse" aria-label="Toggle collapse">
              <svg class="chev" width="14" height="14" viewBox="0 0 24 24"><path d="M7 10l5 5 5-5z" fill="#111"/></svg>
            </button>
          </div>
        </div>

        <div class="card-body">

          <label for="med-0-name" class="medicine-name-label">Medicine Name</label>
          <input id="med-0-name" type="text" name="med[0][name]" placeholder="eg - Vitamin C" required>

          <label for="med-0-dosage" class="dosage-label">Dosage</label>
          <input id="med-0-dosage" type="text" name="med[0][dosage]" placeholder="eg - 500 mg">

          <label class="medium-of-intake-label">Medium of intake</label>
          <div class="medium-group" role="list">
            <label class="medium-option" data-value="Tablet" data-color="blue">
              <input type="radio" name="med[0][medium]" value="Tablet"/>
              <span class="medium-color" style="background:#4c8bfd"></span>
              <span class="medium-icon">üíä</span>
              <span class="medium-label">Tablet</span>
            </label>

            <label class="medium-option" data-value="Capsule" data-color="red">
              <input type="radio" name="med[0][medium]" value="Capsule"/>
              <span class="medium-color" style="background:#ff6b6b"></span>
              <span class="medium-icon">üü£</span>
              <span class="medium-label">Capsule</span>
            </label>

            <label class="medium-option" data-value="Syrup" data-color="green">
              <input type="radio" name="med[0][medium]" value="Syrup"/>
              <span class="medium-color" style="background:#28c76f"></span>
              <span class="medium-icon">üß¥</span>
              <span class="medium-label">Syrup</span>
            </label>

            <label class="medium-option" data-value="Drops" data-color="yellow">
              <input type="radio" name="med[0][medium]" value="Drops"/>
              <span class="medium-color" style="background:#f8d047"></span>
              <span class="medium-icon">üíß</span>
              <span class="medium-label">Drops</span>
            </label>

            <label class="medium-option" data-value="Injection" data-color="purple">
              <input type="radio" name="med[0][medium]" value="Injection"/>
              <span class="medium-color" style="background:#b37eff"></span>
              <span class="medium-icon">üíâ</span>
              <span class="medium-label">Injection</span>
            </label>
          </div>

          <label for="med-0-quantity" class="quantity-label">Quantity of Intake per Dose</label>
          <input id="med-0-quantity" type="number" name="med[0][schedule][quantity_per_dose]" value="1" min="1">

          <label class="when-taken-label">When should this be taken?</label>
          <div class="meal-group" role="radiogroup" aria-label="When to take medicine">
            <div class="meal-option">
              <input class="meal-input" type="radio" id="food-before-0" name="med[0][food]" value="Before Food">
              <label for="food-before-0" class="meal-card">
                <img src="https://images.unsplash.com/photo-1579613832125-5d34a13ffe2a?w=50" alt="Before meal" class="meal-icon">
                <div class="meal-label">Before Meal</div>
              </label>
            </div>

            <div class="meal-option">
              <input class="meal-input" type="radio" id="food-after-0" name="med[0][food]" value="After Food">
              <label for="food-after-0" class="meal-card">
                <img src="https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?w=50" alt="After meal" class="meal-icon">
                <div class="meal-label">After Meal</div>
              </label>
            </div>

            <div class="meal-option">
              <input class="meal-input" type="radio" id="food-none-0" name="med[0][food]" value="No preference" checked>
              <label for="food-none-0" class="meal-card">
                <div class="meal-label">Any Time</div>
              </label>
            </div>
          </div>

          <label for="med-0-notes">Notes (optional)</label>
          <textarea id="med-0-notes" name="med[0][notes]" placeholder="Any additional instructions..."></textarea>

          <div class="manual-save-wrapper">
            <button type="button" class="manual-save-btn">Save</button>
          </div>

          <hr class="divider">

          <h4 class="schedule-title">‚è∞ Schedule</h4>

          <label>Start Date</label>
          <input type="date" name="med[0][schedule][start_date]">

          <label>Duration (days)</label>
          <input type="number" name="med[0][schedule][duration]" min="1">

          <label>Total Quantity</label>
          <input type="number" name="med[0][quantity]" min="1">

          <label>Days of Week</label>
          <div class="days-of-week">
            <button type="button" class="day" data-day="mon">M</button>
            <button type="button" class="day" data-day="tue">T</button>
            <button type="button" class="day" data-day="wed">W</button>
            <button type="button" class="day" data-day="thu">T</button>
            <button type="button" class="day" data-day="fri">F</button>
            <button type="button" class="day" data-day="sat">S</button>
            <button type="button" class="day" data-day="sun">S</button>
          </div>

          <input type="hidden" name="med[0][schedule][days]">

          <label>Time (IST)</label>
          <input type="time" name="med[0][schedule][time]">

          <label>Reminder Options</label>
          <div class="reminder-options">
            <div class="reminder-checkbox-group">
              <input type="checkbox" id="push-notif-0" name="med[0][schedule][reminder]" checked>
              <label for="push-notif-0">üì± Push Notification</label>
            </div>
            <div class="reminder-checkbox-group">
              <input type="checkbox" id="email-notif-0" name="med[0][schedule][email_reminder]">
              <label for="email-notif-0">üìß Email Notification</label>
            </div>
          </div>

        </div>

      </div>

    </div>

    <div class="bottom-actions">
      <button type="button" id="addAnotherBtn" class="add-btn">‚ûï Add Another</button>
      <button type="button" id="nextBtn" class="next-btn">Next ‚Üí Confirmation</button>
    </div>

  </form>
</div>

<script src="{{ url_for('static', filename='js/add_medicine_copy.js') }}"></script>

{% endblock %}